!function () {
  "use strict";
  const BACKEND_HOST = "http://localhost:8080";
  document.addEventListener("DOMContentLoaded", (async () => {
    const stackRequestUri = "/api/stack";
    const getData = async (url) => {
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(response.statusText);
        }
        return await response.json();
      } catch (error) {
        console.log(error);
      }
    }
    const getStacks = async () => {
      const stacks = await getData(BACKEND_HOST + stackRequestUri);
      return stacks;
    }
    const stackTechnologies = await getStacks();
    const $usuallyUsedStackContainer = document.querySelector("[data-tech-stack-usual=\"true\"]") || null;
    const $unUsuallyUsedStackContainer = document.querySelector("[data-tech-stack-usual=\"false\"]") || null;
    if ($usuallyUsedStackContainer && $unusuallyUsedStackContainer) {
      stackTechnologies.forEach(({imagePath, title, isUsuallyUsed}) => {
        let techItemTag = `<div class="tech-stack__ico"><img src="${imagePath}" alt="${title}"></div>`;
        let $container = isUsuallyUsed ? $usuallyUsedStackContainer : $unUsuallyUsedStackContainer;
        $container.insertAdjacentHTML("beforeend", techItemTag);
      });
    }
    const $loginForm = document.querySelector('.login-form');
    if ($loginForm) {
      $loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = new FormData(e.target);
        const res = await fetch(location.origin + e.target.getAttribute('action'), {
          method: 'POST',
          headers: {
            // contentType: 'application/x-www-form-urlencoded',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            email: data.get('email'),
            password: data.get('password')
          })
        });
      });
    }
  }));
}();
